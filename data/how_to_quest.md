# Как писать квесты

### Простой квест

Идейно квест — это перемещение между локациями с помощью кнопок.
У каждой локации есть ключ. Каждая кнопка привязана к локации и у неё есть ключ той локации, куда она ведет.
Если по ключу несколько локаций, то выберется случайный.

Все квесты пишутся в xml-формате. 
Для локаций используется тег <loc key="...">, внутри которого прописывается тег <btn key="..."> для кнопок.
Пример:
```
<loc key="loc1">
Просто первая локация
<btn key="loc2">Идти на вторую</btn>
</loc>
<loc key="loc2">
Просто вторая локация
<btn key="loc1">Идти на первую</btn>
</loc>
<loc key="loc2">
Вы пошли не туда и заблудились
</loc>
```
В примере выше вы можете ходить из первой локации во вторую, пока случайно не забредете в тупик.

_Все, что пишется отдельно: отдельным тегом или все квестовых тегом не учитывается и можно их писать как комментарии. Только не оборачивайте нужные локации/кнопки ни в какие дополнительные теги._

### Опции

Кроме того, можно включать опции. Идейно это параметр, который может включаться/выключаться от кнопок. И кнопки могут появляться на локациях только при определенных опциях. И локации будут выбираться с учетом опций, об этом ниже.

При переходе на локацию по ключу, выберется та локация, которая максимально удовлетворяет вашим текущим опциям. Если таких несколько, из них выберется случайная.

У опций есть приоритет, который вы указываете в начале квеста. Точнее, вы приписываете им символ и те, кто раньше по алфавиту, приоритетнее.

Выбор происходит так: сначала отбрасываются все локации, которые не подходят по опциям. Затем, выбирается та локация (или локации, если таких с одинаковыми опциями несколько), которая имеет наиболее приоритетные опции в как можно большем количестве.

Соответсвенно порядок для параметров a,b,c выглядит так:
```
abc
ab
a
bc
b
c
```

В xml-формате:
В начале документа (в целом это не обязательно в начале писать, ради удобства) опишите вашу опцию тегом: <option key="option_name" char="...">.
В локациях используется атрибут *options*, в который через пробел пишутся все ключи опций(не символы) или ключи опций с восклицательным знаком, запрещающим эту опцию.

Пример:
```
<option key="sword" char="s">

<loc key="fight" options="sword">
Вы не умерли
</loc>

<loc key="fight">
Вы умерли
</loc>
```

В кнопках есть аргумент *req*, в котором через пробел написаны опции(и с ! перед, если опция запрещена), которые указывают, когда кнопка появится на локации. И есть тег *opt*, в котором через пробел указаны какие опции проставятся (или удалятся, если они с ! перед) при нажатии на кнопку.

Пример:
```
<option key="lever1" char="a">
<option key="lever2" char="b">

<loc key="castle">
Вы в замке
<btb key="out" req="lever1 !lever2">Ворота открыты, уйти</btn>
<btb key="castle" req="lever1" opt="!lever1">Опустить первый рычак</btn>
<btb key="castle" req="!lever1" opt="lever1">Поднять первый рычаг</btn>
<btb key="castle" req="lever2" opt="!lever2">Опустить второй рычак</btn>
<btb key="castle" req="!lever2" opt="lever2">Поднять второй рычаг</btn>
</loc>
```

*Важно: символ z использован под технические нужды. Использовать его запрещено!*

### Ачивки

Так же в квестах могут выдаваться ачивки пользователю. Ачивки бывают двух типов:
* Простые. Которые даются за вхождение в локацию
* Из частей, которые собираются из нескольких входов в локацию

Ачивки прописываются в файле achievements_data.py, добавлять описание надо оттуда.
Чтобы добавить простую ачивку на локацию, надо написать тегу локации атрибут achievement="achievement_name"
Чтобы добавить ачивку из частей, надо во все локации, которые надо посетить поставить атрибут achievement="achievement_name_%number_of_part%". Части нумеруются с 1.

### Наши соглашения

Квест начинается с локации с ключом "default". Мы используем навигацию перед всеми квестами из которой доступны все остальные квесты. Поэтому все квесты, кроме навигации, начинаем таким ключом: %название_квеста%-start.

Поскольку квесты, лежащие в разных файлах об этом не знают, все ключи локаций тоже надо начинать с %название_квеста%-
Символы опций z и y зарезервированы под технические и навигационные нужды соответсвенно.

### Как тестировать

После установки репозитория, вы можете запускать модуль quest_console_test.py. 
Такой строчкой запуска:
```python3 quest_console_test.py [--log|-l] [file_name1 file_name2...]```
Он загрузит указанные файлы и вы сможете в консоли пройтись по приключению.
Опция --log пишет отладочную информацию о квесте в консоль.
